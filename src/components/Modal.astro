---
import NumberOfTags from "./NumberOfTags";
---

<tags-modal-wrapper>
  <button
    id="open-modal-button"
    class="border border-primary-grey text-primary-darkGrey hover:text-primary-black rounded-[40px] py-1 px-3 md:py-2 text-sm flex gap-1.5 items-center justify-center h-fit hover:border-primary-darkGrey transition-all duration-200 ease-in-out disabled:hover:border-primary-grey disabled:hover:text-primary-darkGrey disabled:opacity-50 disabled:cursor-not-allowed"
  >
    <p>Tags</p>
    <NumberOfTags client:load />
  </button>
  <div
    id="modal"
    class="hidden max-w-[400px] min-w-[300px] md:w-[450px] h-[275px] fixed top-1/2 left-1/2 -translate-x-1/2 bg-white border border-gray-200 rounded-2xl opacity-0 transition-all duration-300 ease-in-out animate-fadeIn max-h-[90vh] z-40"
    role="dialog"
  >
    <slot />
  </div>
  <div
    id="overlay"
    class="hidden fixed inset-0 w-full h-full bg-black bg-opacity-50 backdrop-blur-sm z-30"
  >
  </div>
</tags-modal-wrapper>

<script>
  import { taggedPeople } from "../stores/store";

  class TagsModalWrapper extends HTMLElement {
    constructor() {
      super();
      const openModalButton = this.querySelector(
        "#open-modal-button"
      ) as HTMLButtonElement;
      const modal = this.querySelector("#modal");
      const overlay = this.querySelector("#overlay");

      function closeModal() {
        modal?.classList.remove("opacity-100", "block", "animate-fadeIn");
        modal?.classList.add("opacity-0", "hidden");
        overlay?.classList.add("hidden");
        document.body.classList.remove("overflow-hidden");
      }

      function openModal() {
        modal?.classList.remove("opacity-0", "hidden");
        modal?.classList.add("opacity-100", "block", "animate-fadeIn");
        overlay?.classList.remove("hidden");
        document.body.classList.add("overflow-hidden");
      }

      openModalButton.addEventListener("click", openModal);
      overlay?.addEventListener("click", closeModal);

      // Update button state based on taggedPeople store
      taggedPeople.subscribe((tags) => {
        openModalButton.disabled = tags.length === 0;
      });
    }
  }

  customElements.define("tags-modal-wrapper", TagsModalWrapper);
</script>

<style>
  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translate(-50%, -50%) translateY(4px);
    }
    to {
      opacity: 1;
      transform: translate(-50%, -50%) translateY(0);
    }
  }

  #modal.animate-fadeIn {
    animation: fadeIn 0.3s ease-out forwards;
  }
</style>
